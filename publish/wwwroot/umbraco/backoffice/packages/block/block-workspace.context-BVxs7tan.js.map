{"version":3,"file":"block-workspace.context-BVxs7tan.js","sources":["../../../src/packages/block/block/workspace/block-workspace-editor.element.ts","../../../src/packages/block/block/workspace/block-element-property-dataset.context.ts","../../../src/packages/block/block/workspace/block-element-manager.ts","../../../src/packages/block/block/workspace/block-workspace.context.ts"],"sourcesContent":["import { UMB_BLOCK_WORKSPACE_CONTEXT } from './index.js';\r\nimport { UmbTextStyles } from '@umbraco-cms/backoffice/style';\r\nimport { customElement, css, html, state } from '@umbraco-cms/backoffice/external/lit';\r\nimport { UmbLitElement } from '@umbraco-cms/backoffice/lit-element';\r\nimport { observeMultiple } from '@umbraco-cms/backoffice/observable-api';\r\n\r\n@customElement('umb-block-workspace-editor')\r\nexport class UmbBlockWorkspaceEditorElement extends UmbLitElement {\r\n\tconstructor() {\r\n\t\tsuper();\r\n\t\tthis.consumeContext(UMB_BLOCK_WORKSPACE_CONTEXT, (context) => {\r\n\t\t\tthis.observe(\r\n\t\t\t\tobserveMultiple([\r\n\t\t\t\t\tcontext.isNew,\r\n\t\t\t\t\tcontext.content.structure.ownerContentTypeObservablePart((contentType) => contentType?.name),\r\n\t\t\t\t]),\r\n\t\t\t\t([isNew, name]) => {\r\n\t\t\t\t\tthis._headline =\r\n\t\t\t\t\t\tthis.localize.term(isNew ? 'general_add' : 'general_edit') + ' ' + this.localize.string(name);\r\n\t\t\t\t},\r\n\t\t\t\t'observeOwnerContentElementTypeName',\r\n\t\t\t);\r\n\t\t});\r\n\t}\r\n\r\n\t@state()\r\n\t_headline: string = '';\r\n\r\n\toverride render() {\r\n\t\treturn html`<umb-workspace-editor headline=${this._headline}> </umb-workspace-editor> `;\r\n\t}\r\n\r\n\tstatic override readonly styles = [\r\n\t\tUmbTextStyles,\r\n\t\tcss`\r\n\t\t\t:host {\r\n\t\t\t\tdisplay: block;\r\n\t\t\t\twidth: 100%;\r\n\t\t\t\theight: 100%;\r\n\t\t\t}\r\n\t\t`,\r\n\t];\r\n}\r\n\r\nexport default UmbBlockWorkspaceEditorElement;\r\n\r\ndeclare global {\r\n\tinterface HTMLElementTagNameMap {\r\n\t\t'umb-block-workspace-editor': UmbBlockWorkspaceEditorElement;\r\n\t}\r\n}\r\n","import type { UmbBlockElementManager } from './block-element-manager.js';\r\nimport { UMB_BLOCK_WORKSPACE_CONTEXT } from './block-workspace.context-token.js';\r\nimport type { UmbPropertyDatasetContext } from '@umbraco-cms/backoffice/property';\r\nimport type { UmbControllerHost } from '@umbraco-cms/backoffice/controller-api';\r\nimport type { UmbVariantId } from '@umbraco-cms/backoffice/variant';\r\nimport { UmbElementPropertyDatasetContext } from '@umbraco-cms/backoffice/content';\r\nimport { createObservablePart } from '@umbraco-cms/backoffice/observable-api';\r\n\r\nexport class UmbBlockElementPropertyDatasetContext\r\n\textends UmbElementPropertyDatasetContext\r\n\timplements UmbPropertyDatasetContext\r\n{\r\n\treadonly name;\r\n\treadonly culture;\r\n\treadonly segment;\r\n\treadonly getName;\r\n\r\n\tconstructor(host: UmbControllerHost, elementManager: UmbBlockElementManager, variantId?: UmbVariantId) {\r\n\t\t// The controller alias, is a very generic name cause we want only one of these for this controller host.\r\n\t\tsuper(host, elementManager, variantId);\r\n\r\n\t\t// Ugly, but we just inherit these from the workspace context: [NL]\r\n\t\tthis.name = elementManager.name;\r\n\t\tthis.getName = elementManager.getName;\r\n\t\tthis.culture = createObservablePart(elementManager.variantId, (v) => v?.culture);\r\n\t\tthis.segment = createObservablePart(elementManager.variantId, (v) => v?.segment);\r\n\r\n\t\tthis.consumeContext(UMB_BLOCK_WORKSPACE_CONTEXT, (workspace) => {\r\n\t\t\tthis.observe(\r\n\t\t\t\tworkspace.readOnlyState.states,\r\n\t\t\t\t(states) => {\r\n\t\t\t\t\tconst isReadOnly = states.some((state) => state.variantId.equal(elementManager.getVariantId()));\r\n\t\t\t\t\tthis._readOnly.setValue(isReadOnly);\r\n\t\t\t\t},\r\n\t\t\t\t'umbObserveReadOnlyStates',\r\n\t\t\t);\r\n\t\t});\r\n\t}\r\n}\r\n","import type { UmbBlockDataModel, UmbBlockDataValueModel, UmbBlockLayoutBaseModel } from '../types.js';\r\nimport { UmbBlockElementPropertyDatasetContext } from './block-element-property-dataset.context.js';\r\nimport type { UmbBlockWorkspaceContext } from './block-workspace.context.js';\r\nimport type { UmbContentTypeModel, UmbPropertyTypeModel } from '@umbraco-cms/backoffice/content-type';\r\nimport { UmbContentTypeStructureManager } from '@umbraco-cms/backoffice/content-type';\r\nimport {\r\n\ttype Observable,\r\n\tUmbClassState,\r\n\tappendToFrozenArray,\r\n\tmergeObservables,\r\n} from '@umbraco-cms/backoffice/observable-api';\r\nimport type { UmbControllerHost } from '@umbraco-cms/backoffice/controller-api';\r\nimport { type UmbClassInterface, UmbControllerBase } from '@umbraco-cms/backoffice/class-api';\r\nimport { UmbDocumentTypeDetailRepository } from '@umbraco-cms/backoffice/document-type';\r\nimport { UmbVariantId } from '@umbraco-cms/backoffice/variant';\r\nimport { UmbValidationController } from '@umbraco-cms/backoffice/validation';\r\nimport { UmbElementWorkspaceDataManager, type UmbElementPropertyDataOwner } from '@umbraco-cms/backoffice/content';\r\nimport { UmbReadOnlyVariantStateManager } from '@umbraco-cms/backoffice/utils';\r\n\r\nimport { UmbDataTypeItemRepositoryManager } from '@umbraco-cms/backoffice/data-type';\r\n\r\nexport class UmbBlockElementManager<LayoutDataType extends UmbBlockLayoutBaseModel = UmbBlockLayoutBaseModel>\r\n\textends UmbControllerBase\r\n\timplements UmbElementPropertyDataOwner<UmbBlockDataModel, UmbContentTypeModel>\r\n{\r\n\t//\r\n\r\n\treadonly #data = new UmbElementWorkspaceDataManager<UmbBlockDataModel>(this);\r\n\t//#data = new UmbObjectState<UmbBlockDataModel | undefined>(undefined);\r\n\treadonly data = this.#data.current;\r\n\t#getDataPromise = new Promise<void>((resolve) => {\r\n\t\tthis.#getDataResolver = resolve;\r\n\t});\r\n\t#getDataResolver!: () => void;\r\n\r\n\tpublic readonly readOnlyState = new UmbReadOnlyVariantStateManager(this);\r\n\r\n\t#variantId = new UmbClassState<UmbVariantId | undefined>(undefined);\r\n\treadonly variantId = this.#variantId.asObservable();\r\n\r\n\treadonly name;\r\n\treadonly getName;\r\n\treadonly unique = this.#data.createObservablePartOfCurrent((data) => data?.key);\r\n\treadonly contentTypeId = this.#data.createObservablePartOfCurrent((data) => data?.contentTypeKey);\r\n\r\n\treadonly values = this.#data.createObservablePartOfCurrent((data) => data?.values);\r\n\tgetValues() {\r\n\t\treturn this.#data.getCurrent()?.values;\r\n\t}\r\n\r\n\treadonly #dataTypeItemManager = new UmbDataTypeItemRepositoryManager(this);\r\n\t#dataTypeSchemaAliasMap = new Map<string, string>();\r\n\r\n\treadonly structure = new UmbContentTypeStructureManager<UmbContentTypeModel>(\r\n\t\tthis,\r\n\t\tnew UmbDocumentTypeDetailRepository(this),\r\n\t);\r\n\r\n\treadonly validation = new UmbValidationController(this);\r\n\r\n\tconstructor(host: UmbBlockWorkspaceContext<LayoutDataType>, dataPathPropertyName: string) {\r\n\t\tsuper(host);\r\n\r\n\t\t// Ugly, but we just inherit these from the workspace context: [NL]\r\n\t\tthis.name = host.name;\r\n\t\tthis.getName = host.getName;\r\n\r\n\t\tthis.observe(this.contentTypeId, (id) => this.structure.loadType(id));\r\n\t\tthis.observe(this.unique, (key) => {\r\n\t\t\tif (key) {\r\n\t\t\t\tthis.validation.setDataPath('$.' + dataPathPropertyName + `[?(@.key == '${key}')]`);\r\n\t\t\t}\r\n\t\t});\r\n\r\n\t\tthis.observe(\r\n\t\t\tthis.structure.contentTypeDataTypeUniques,\r\n\t\t\t(dataTypeUniques: Array<string>) => {\r\n\t\t\t\tthis.#dataTypeItemManager.setUniques(dataTypeUniques);\r\n\t\t\t},\r\n\t\t\tnull,\r\n\t\t);\r\n\t\tthis.observe(\r\n\t\t\tthis.#dataTypeItemManager.items,\r\n\t\t\t(dataTypes) => {\r\n\t\t\t\t// Make a map of the data type unique and editorAlias:\r\n\t\t\t\tthis.#dataTypeSchemaAliasMap = new Map(\r\n\t\t\t\t\tdataTypes.map((dataType) => {\r\n\t\t\t\t\t\treturn [dataType.unique, dataType.propertyEditorSchemaAlias];\r\n\t\t\t\t\t}),\r\n\t\t\t\t);\r\n\t\t\t},\r\n\t\t\tnull,\r\n\t\t);\r\n\t}\r\n\r\n\tpublic isLoaded() {\r\n\t\treturn this.#getDataPromise;\r\n\t}\r\n\r\n\tresetState() {\r\n\t\tthis.#data.clear();\r\n\t}\r\n\r\n\tsetVariantId(variantId: UmbVariantId | undefined) {\r\n\t\tthis.#variantId.setValue(variantId);\r\n\t}\r\n\tgetVariantId(): UmbVariantId {\r\n\t\treturn this.#variantId.getValue() ?? UmbVariantId.CreateInvariant();\r\n\t}\r\n\r\n\t// TODO: rename to currentData:\r\n\tsetData(data: UmbBlockDataModel | undefined) {\r\n\t\tthis.#data.setPersisted(data);\r\n\t\tthis.#data.setCurrent(data);\r\n\t\tthis.#getDataResolver();\r\n\t}\r\n\r\n\tgetData() {\r\n\t\treturn this.#data.getCurrent();\r\n\t}\r\n\r\n\tsetPersistedData(data: UmbBlockDataModel | undefined) {\r\n\t\tthis.#data.setPersisted(data);\r\n\t}\r\n\r\n\t/**\r\n\t * Check if there are unpersisted changes.\r\n\t * @returns { boolean } true if there are unpersisted changes.\r\n\t */\r\n\tpublic getHasUnpersistedChanges(): boolean {\r\n\t\treturn this.#data.getHasUnpersistedChanges();\r\n\t}\r\n\r\n\tgetUnique() {\r\n\t\treturn this.getData()?.key;\r\n\t}\r\n\r\n\tgetEntityType() {\r\n\t\treturn 'element';\r\n\t}\r\n\r\n\tgetContentTypeId() {\r\n\t\treturn this.getData()?.contentTypeKey;\r\n\t}\r\n\r\n\t#createPropertyVariantId(property: UmbPropertyTypeModel, variantId: UmbVariantId) {\r\n\t\treturn variantId.toVariant(property.variesByCulture, property.variesBySegment);\r\n\t}\r\n\r\n\t// We will implement propertyAlias in the future, when implementing Varying Blocks. [NL]\r\n\r\n\tasync propertyVariantId(propertyAlias: string) {\r\n\t\treturn mergeObservables(\r\n\t\t\t[await this.structure.propertyStructureByAlias(propertyAlias), this.variantId],\r\n\t\t\t([property, variantId]) =>\r\n\t\t\t\tproperty && variantId ? this.#createPropertyVariantId(property, variantId) : undefined,\r\n\t\t);\r\n\t}\r\n\r\n\t/**\r\n\t * @function propertyValueByAlias\r\n\t * @param {string} propertyAlias - The alias of the property\r\n\t * @param {UmbVariantId} variantId - The variant\r\n\t * @returns {Promise<Observable<ReturnType | undefined> | undefined>} - An observable for the value of the property\r\n\t * @description Get an Observable for the value of this property.\r\n\t */\r\n\tasync propertyValueByAlias<PropertyValueType = unknown>(\r\n\t\tpropertyAlias: string,\r\n\t\tvariantId?: UmbVariantId,\r\n\t): Promise<Observable<PropertyValueType | undefined> | undefined> {\r\n\t\treturn this.#data.createObservablePartOfCurrent(\r\n\t\t\t(data) =>\r\n\t\t\t\tdata?.values?.find((x) => x?.alias === propertyAlias && (variantId ? variantId.compare(x) : true))\r\n\t\t\t\t\t?.value as PropertyValueType,\r\n\t\t);\r\n\t}\r\n\r\n\t/**\r\n\t * Get the current value of the property with the given alias and variantId.\r\n\t * @param {string} alias - The alias of the property\r\n\t * @param {UmbVariantId | undefined} variantId - The variant id of the property\r\n\t * @returns {ReturnType | undefined} The value or undefined if not set or found.\r\n\t */\r\n\tgetPropertyValue<ReturnType = unknown>(alias: string, variantId?: UmbVariantId) {\r\n\t\tconst currentData = this.#data.getCurrent();\r\n\t\tif (currentData) {\r\n\t\t\tconst newDataSet = currentData.values?.find(\r\n\t\t\t\t(x) => x.alias === alias && (variantId ? variantId.compare(x) : true),\r\n\t\t\t);\r\n\t\t\treturn newDataSet?.value as ReturnType;\r\n\t\t}\r\n\t\treturn undefined;\r\n\t}\r\n\tasync setPropertyValue<ValueType = unknown>(alias: string, value: ValueType, variantId?: UmbVariantId) {\r\n\t\tthis.initiatePropertyValueChange();\r\n\t\tvariantId ??= UmbVariantId.CreateInvariant();\r\n\t\tconst property = await this.structure.getPropertyStructureByAlias(alias);\r\n\r\n\t\tif (!property) {\r\n\t\t\tthrow new Error(`Property alias \"${alias}\" not found.`);\r\n\t\t}\r\n\r\n\t\t// TODO: I think we should await this in the same way as we do for Content Detail Workspace Context. [NL]\r\n\t\tconst editorAlias = this.#dataTypeSchemaAliasMap.get(property.dataType.unique);\r\n\t\tif (!editorAlias) {\r\n\t\t\tthrow new Error(`Editor Alias of \"${property.dataType.unique}\" not found.`);\r\n\t\t}\r\n\r\n\t\tconst entry = { editorAlias, ...variantId.toObject(), alias, value } as UmbBlockDataValueModel<ValueType>;\r\n\r\n\t\tconst currentData = this.getData();\r\n\t\tif (currentData) {\r\n\t\t\tconst values = appendToFrozenArray(\r\n\t\t\t\tcurrentData.values ?? [],\r\n\t\t\t\tentry,\r\n\t\t\t\t(x) => x.alias === alias && variantId!.compare(x),\r\n\t\t\t);\r\n\t\t\tthis.#data.updateCurrent({ values });\r\n\t\t}\r\n\t\tthis.finishPropertyValueChange();\r\n\t}\r\n\r\n\tinitiatePropertyValueChange() {\r\n\t\tthis.#data.initiatePropertyValueChange();\r\n\t}\r\n\tfinishPropertyValueChange = () => {\r\n\t\tthis.#data.finishPropertyValueChange();\r\n\t};\r\n\r\n\tpublic createPropertyDatasetContext(host: UmbControllerHost, variantId: UmbVariantId) {\r\n\t\treturn new UmbBlockElementPropertyDatasetContext(host, this, variantId);\r\n\t}\r\n\r\n\tpublic setup(host: UmbClassInterface, variantId: UmbVariantId) {\r\n\t\tthis.createPropertyDatasetContext(host, variantId);\r\n\r\n\t\t// Provide Validation Context for this view:\r\n\t\tthis.validation.provideAt(host);\r\n\t}\r\n\r\n\tpublic override destroy(): void {\r\n\t\tthis.structure.destroy();\r\n\t\tsuper.destroy();\r\n\t}\r\n}\r\n\r\nexport default UmbBlockElementManager;\r\n","import type { UmbBlockDataModel, UmbBlockLayoutBaseModel } from '../types.js';\r\nimport { UmbBlockWorkspaceEditorElement } from './block-workspace-editor.element.js';\r\nimport { UmbBlockElementManager } from './block-element-manager.js';\r\nimport {\r\n\tUmbSubmittableWorkspaceContextBase,\r\n\ttype UmbRoutableWorkspaceContext,\r\n\tUmbWorkspaceIsNewRedirectController,\r\n\ttype ManifestWorkspace,\r\n\tUmbWorkspaceIsNewRedirectControllerAlias,\r\n} from '@umbraco-cms/backoffice/workspace';\r\nimport {\r\n\tUmbBooleanState,\r\n\tUmbClassState,\r\n\tUmbObjectState,\r\n\tUmbStringState,\r\n\tobserveMultiple,\r\n} from '@umbraco-cms/backoffice/observable-api';\r\nimport type { UmbControllerHost } from '@umbraco-cms/backoffice/controller-api';\r\nimport { UMB_DISCARD_CHANGES_MODAL, UMB_MODAL_CONTEXT, UMB_MODAL_MANAGER_CONTEXT } from '@umbraco-cms/backoffice/modal';\r\nimport { decodeFilePath, UmbReadOnlyVariantStateManager } from '@umbraco-cms/backoffice/utils';\r\nimport {\r\n\tUMB_BLOCK_ENTRIES_CONTEXT,\r\n\tUMB_BLOCK_MANAGER_CONTEXT,\r\n\ttype UmbBlockWorkspaceOriginData,\r\n\tUMB_BLOCK_ENTRY_CONTEXT,\r\n} from '@umbraco-cms/backoffice/block';\r\nimport { UmbVariantId } from '@umbraco-cms/backoffice/variant';\r\nimport type { UUIModalSidebarSize } from '@umbraco-cms/backoffice/external/uui';\r\n\r\nexport type UmbBlockWorkspaceElementManagerNames = 'content' | 'settings';\r\nexport class UmbBlockWorkspaceContext<LayoutDataType extends UmbBlockLayoutBaseModel = UmbBlockLayoutBaseModel>\r\n\textends UmbSubmittableWorkspaceContextBase<LayoutDataType>\r\n\timplements UmbRoutableWorkspaceContext\r\n{\r\n\t// Just for context token safety:\r\n\tpublic readonly IS_BLOCK_WORKSPACE_CONTEXT = true;\r\n\t//\r\n\r\n\t#blockManager?: typeof UMB_BLOCK_MANAGER_CONTEXT.TYPE;\r\n\t#retrieveBlockManager;\r\n\t#blockEntries?: typeof UMB_BLOCK_ENTRIES_CONTEXT.TYPE;\r\n\t#retrieveBlockEntries;\r\n\t#originData?: UmbBlockWorkspaceOriginData;\r\n\t// Set the origin data for this workspace. Example used by inline editing which setups the workspace context it self.\r\n\tsetOriginData(data: UmbBlockWorkspaceOriginData) {\r\n\t\tthis.#originData = data;\r\n\t}\r\n\t#modalContext?: typeof UMB_MODAL_CONTEXT.TYPE;\r\n\t#retrieveModalContext;\r\n\r\n\t#entityType: string;\r\n\r\n\t#liveEditingMode?: boolean;\r\n\r\n\t#initialLayout?: LayoutDataType;\r\n\t#initialContent?: UmbBlockDataModel;\r\n\t#initialSettings?: UmbBlockDataModel;\r\n\r\n\t#layout = new UmbObjectState<LayoutDataType | undefined>(undefined);\r\n\treadonly layout = this.#layout.asObservable();\r\n\treadonly unique = this.#layout.asObservablePart((x) => x?.contentKey);\r\n\treadonly contentKey = this.#layout.asObservablePart((x) => x?.contentKey);\r\n\r\n\treadonly content = new UmbBlockElementManager(this, 'contentData');\r\n\r\n\treadonly settings = new UmbBlockElementManager(this, 'settingsData');\r\n\r\n\t#name = new UmbStringState<string | undefined>(undefined);\r\n\treadonly name = this.#name.asObservable();\r\n\r\n\t#variantId = new UmbClassState<UmbVariantId | undefined>(undefined);\r\n\treadonly variantId = this.#variantId.asObservable();\r\n\r\n\t#exposed = new UmbBooleanState<undefined>(undefined);\r\n\treadonly exposed = this.#exposed.asObservable();\r\n\r\n\tpublic readonly readOnlyState = new UmbReadOnlyVariantStateManager(this);\r\n\r\n\tconstructor(host: UmbControllerHost, workspaceArgs: { manifest: ManifestWorkspace }) {\r\n\t\tsuper(host, workspaceArgs.manifest.alias);\r\n\t\tconst manifest = workspaceArgs.manifest;\r\n\t\tthis.#entityType = manifest.meta?.entityType;\r\n\r\n\t\twindow.addEventListener('willchangestate', this.#onWillNavigate);\r\n\r\n\t\tthis.addValidationContext(this.content.validation);\r\n\t\tthis.addValidationContext(this.settings.validation);\r\n\r\n\t\tthis.#retrieveModalContext = this.consumeContext(UMB_MODAL_CONTEXT, (context) => {\r\n\t\t\tthis.#modalContext = context;\r\n\t\t\tthis.#originData = context?.data.originData;\r\n\t\t\tcontext.onSubmit().catch(this.#modalRejected);\r\n\t\t}).asPromise();\r\n\r\n\t\tthis.#retrieveBlockManager = this.consumeContext(UMB_BLOCK_MANAGER_CONTEXT, (manager) => {\r\n\t\t\tthis.#blockManager = manager;\r\n\t\t\tthis.#gotManager();\r\n\t\t});\r\n\r\n\t\tthis.#retrieveBlockEntries = this.consumeContext(UMB_BLOCK_ENTRIES_CONTEXT, (context) => {\r\n\t\t\tthis.#blockEntries = context;\r\n\t\t}).asPromise();\r\n\r\n\t\tthis.consumeContext(UMB_BLOCK_ENTRY_CONTEXT, (context) => {\r\n\t\t\tthis.#name.setValue(context.getName());\r\n\t\t});\r\n\r\n\t\tthis.observe(this.variantId, (variantId) => {\r\n\t\t\tthis.content.setVariantId(variantId);\r\n\t\t\tthis.settings.setVariantId(variantId);\r\n\t\t});\r\n\r\n\t\tthis.routes.setRoutes([\r\n\t\t\t{\r\n\t\t\t\tpath: 'create/:elementTypeKey',\r\n\t\t\t\tcomponent: UmbBlockWorkspaceEditorElement,\r\n\t\t\t\tsetup: async (component, info) => {\r\n\t\t\t\t\tconst elementTypeKey = info.match.params.elementTypeKey;\r\n\t\t\t\t\tawait this.create(elementTypeKey);\r\n\r\n\t\t\t\t\tnew UmbWorkspaceIsNewRedirectController(\r\n\t\t\t\t\t\tthis,\r\n\t\t\t\t\t\tthis,\r\n\t\t\t\t\t\tthis.getHostElement().shadowRoot!.querySelector('umb-router-slot')!,\r\n\t\t\t\t\t);\r\n\t\t\t\t},\r\n\t\t\t},\r\n\t\t\t{\r\n\t\t\t\tpath: 'edit/:key',\r\n\t\t\t\tcomponent: UmbBlockWorkspaceEditorElement,\r\n\t\t\t\tsetup: (component, info) => {\r\n\t\t\t\t\tconst key = decodeFilePath(info.match.params.key);\r\n\t\t\t\t\tthis.load(key);\r\n\t\t\t\t},\r\n\t\t\t},\r\n\t\t]);\r\n\t}\r\n\r\n\t#gotManager() {\r\n\t\tif (!this.#blockManager) return;\r\n\t\tconst manager = this.#blockManager;\r\n\r\n\t\tthis.observe(\r\n\t\t\tmanager.liveEditingMode,\r\n\t\t\t(liveEditingMode) => {\r\n\t\t\t\tthis.#liveEditingMode = liveEditingMode ?? false;\r\n\t\t\t},\r\n\t\t\t'observeLiveEditingMode',\r\n\t\t);\r\n\r\n\t\tthis.observe(\r\n\t\t\tobserveMultiple([\r\n\t\t\t\tmanager.variantId,\r\n\t\t\t\tthis.content.structure.variesByCulture,\r\n\t\t\t\tthis.content.structure.variesBySegment,\r\n\t\t\t]),\r\n\t\t\t([variantId, variesByCulture, variesBySegment]) => {\r\n\t\t\t\tif (!variantId || variesByCulture === undefined || variesBySegment === undefined) return;\r\n\r\n\t\t\t\tif (!variesBySegment && !variesByCulture) {\r\n\t\t\t\t\tvariantId = UmbVariantId.CreateInvariant();\r\n\t\t\t\t} else if (!variesBySegment) {\r\n\t\t\t\t\tvariantId = variantId.toSegmentInvariant();\r\n\t\t\t\t} else if (!variesByCulture) {\r\n\t\t\t\t\tvariantId = variantId.toCultureInvariant();\r\n\t\t\t\t}\r\n\r\n\t\t\t\tthis.#variantId.setValue(variantId);\r\n\t\t\t},\r\n\t\t\t'observeVariantIds',\r\n\t\t);\r\n\r\n\t\tthis.removeUmbControllerByAlias('observeHasExpose');\r\n\t\tthis.observe(\r\n\t\t\tobserveMultiple([this.contentKey, this.variantId]),\r\n\t\t\t([contentKey, variantId]) => {\r\n\t\t\t\tif (!contentKey || !variantId) return;\r\n\r\n\t\t\t\tthis.observe(\r\n\t\t\t\t\tmanager.hasExposeOf(contentKey, variantId),\r\n\t\t\t\t\t(exposed) => {\r\n\t\t\t\t\t\tthis.#exposed.setValue(exposed);\r\n\t\t\t\t\t},\r\n\t\t\t\t\t'observeHasExpose',\r\n\t\t\t\t);\r\n\t\t\t},\r\n\t\t\t'observeContentKeyAndVariantId',\r\n\t\t);\r\n\r\n\t\tthis.observe(\r\n\t\t\tobserveMultiple([manager.readOnlyState.isReadOnly, this.variantId]),\r\n\t\t\t([isReadOnly, variantId]) => {\r\n\t\t\t\tconst unique = 'UMB_BLOCK_MANAGER_CONTEXT';\r\n\t\t\t\tif (variantId === undefined) return;\r\n\r\n\t\t\t\tif (isReadOnly) {\r\n\t\t\t\t\tconst state = {\r\n\t\t\t\t\t\tunique,\r\n\t\t\t\t\t\tvariantId,\r\n\t\t\t\t\t\tmessage: '',\r\n\t\t\t\t\t};\r\n\r\n\t\t\t\t\tthis.readOnlyState?.addState(state);\r\n\t\t\t\t} else {\r\n\t\t\t\t\tthis.readOnlyState?.removeState(unique);\r\n\t\t\t\t}\r\n\t\t\t},\r\n\t\t\t'observeIsReadOnly',\r\n\t\t);\r\n\r\n\t\tthis.observe(\r\n\t\t\tthis.content.contentTypeId,\r\n\t\t\t(contentTypeId) => {\r\n\t\t\t\tthis.observe(\r\n\t\t\t\t\tcontentTypeId ? manager.blockTypeOf(contentTypeId) : undefined,\r\n\t\t\t\t\t(blockType) => {\r\n\t\t\t\t\t\tif (blockType?.editorSize) {\r\n\t\t\t\t\t\t\tthis.setEditorSize(blockType.editorSize);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t},\r\n\t\t\t\t\t'observeBlockType',\r\n\t\t\t\t);\r\n\t\t\t},\r\n\t\t\t'observeContentTypeId',\r\n\t\t);\r\n\t}\r\n\r\n\t#allowNavigateAway = false;\r\n\t#onWillNavigate = async (e: CustomEvent) => {\r\n\t\tconst newUrl = e.detail.url;\r\n\r\n\t\tif (this.#allowNavigateAway) {\r\n\t\t\treturn true;\r\n\t\t}\r\n\r\n\t\tif (this._checkWillNavigateAway(newUrl) && this.getHasUnpersistedChanges()) {\r\n\t\t\t/* Since ours modals are async while events are synchronous, we need to prevent the default behavior of the event, even if the modal hasnâ€™t been resolved yet.\r\n\t\t\tOnce the modal is resolved (the user accepted to discard the changes and navigate away from the route), we will push a new history state.\r\n\t\t\tThis push will make the \"willchangestate\" event happen again and due to this somewhat \"backward\" behavior,\r\n\t\t\twe set an \"allowNavigateAway\"-flag to prevent the \"discard-changes\" functionality from running in a loop.*/\r\n\t\t\te.preventDefault();\r\n\t\t\tconst modalManager = await this.getContext(UMB_MODAL_MANAGER_CONTEXT).catch(() => undefined);\r\n\t\t\tconst modal = modalManager?.open(this, UMB_DISCARD_CHANGES_MODAL);\r\n\t\t\tif (modal) {\r\n\t\t\t\ttry {\r\n\t\t\t\t\t// navigate to the new url when discarding changes\r\n\t\t\t\t\tawait modal.onSubmit();\r\n\t\t\t\t\tthis.#allowNavigateAway = true;\r\n\t\t\t\t\thistory.pushState({}, '', e.detail.url);\r\n\t\t\t\t\treturn true;\r\n\t\t\t\t} catch {\r\n\t\t\t\t\treturn false;\r\n\t\t\t\t}\r\n\t\t\t} else {\r\n\t\t\t\tconsole.error('No modal manager found!');\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\treturn true;\r\n\t};\r\n\r\n\t/**\r\n\t * Check if the workspace is about to navigate away.\r\n\t * @protected\r\n\t * @param {string} newUrl The new url that the workspace is navigating to.\r\n\t * @returns { boolean} true if the workspace is navigating away.\r\n\t * @memberof UmbEntityWorkspaceContextBase\r\n\t */\r\n\tprotected _checkWillNavigateAway(newUrl: string): boolean {\r\n\t\treturn !newUrl.includes(this.routes.getActiveLocalPath());\r\n\t}\r\n\r\n\tsetEditorSize(editorSize: UUIModalSidebarSize) {\r\n\t\tthis.#modalContext?.setModalSize(editorSize);\r\n\t}\r\n\r\n\tprotected override resetState() {\r\n\t\tsuper.resetState();\r\n\t\tthis.#name.setValue(undefined);\r\n\t\tthis.#layout.setValue(undefined);\r\n\t\tthis.#initialLayout = undefined;\r\n\t\tthis.#initialContent = undefined;\r\n\t\tthis.#initialSettings = undefined;\r\n\t\tthis.content.resetState();\r\n\t\tthis.settings.resetState();\r\n\t\tthis.#allowNavigateAway = false;\r\n\t\tthis.removeUmbControllerByAlias(UmbWorkspaceIsNewRedirectControllerAlias);\r\n\t}\r\n\r\n\tasync load(unique: string) {\r\n\t\tawait this.#retrieveBlockManager;\r\n\t\tawait this.#retrieveBlockEntries;\r\n\t\tif (!this.#blockManager || !this.#blockEntries) {\r\n\t\t\tthrow new Error('Block manager not found');\r\n\t\t}\r\n\r\n\t\tthis.observe(\r\n\t\t\tthis.#blockEntries.layoutOf(unique),\r\n\t\t\t(layoutData) => {\r\n\t\t\t\tthis.#initialLayout ??= layoutData as LayoutDataType;\r\n\t\t\t\tthis.removeUmbControllerByAlias('observeLayoutInitially');\r\n\t\t\t},\r\n\t\t\t'observeLayoutInitially',\r\n\t\t);\r\n\r\n\t\tthis.#observeBlockData(unique);\r\n\t\tif (this.#liveEditingMode) {\r\n\t\t\tthis.establishLiveSync();\r\n\t\t}\r\n\t}\r\n\r\n\tasync create(contentElementTypeId: string) {\r\n\t\tawait this.#retrieveBlockEntries;\r\n\t\tawait this.#retrieveModalContext;\r\n\t\tif (!this.#blockEntries) {\r\n\t\t\tthrow new Error('Block Entries not found');\r\n\t\t}\r\n\t\tif (!this.#originData) {\r\n\t\t\tthrow new Error('Origin data not defined');\r\n\t\t}\r\n\r\n\t\t// TODO: Missing some way to append more layout data... this could be part of modal data, (or context api?)\r\n\r\n\t\tthis.setIsNew(true);\r\n\r\n\t\tconst blockCreated = await this.#blockEntries.create(contentElementTypeId, {}, this.#originData);\r\n\t\tif (!blockCreated) {\r\n\t\t\tthrow new Error('Block Entries could not create block');\r\n\t\t}\r\n\r\n\t\t// TODO: We should investigate if it makes sense to gather\r\n\r\n\t\tif (this.#liveEditingMode) {\r\n\t\t\t// Insert already, cause we are in live editing mode:\r\n\t\t\tconst blockInserted = await this.#blockEntries.insert(\r\n\t\t\t\tblockCreated.layout,\r\n\t\t\t\tblockCreated.content,\r\n\t\t\t\tblockCreated.settings,\r\n\t\t\t\tthis.#originData,\r\n\t\t\t);\r\n\t\t\tif (!blockInserted) {\r\n\t\t\t\tthrow new Error('Block Entries could not insert block');\r\n\t\t\t}\r\n\r\n\t\t\tconst unique = blockCreated.layout.contentKey;\r\n\r\n\t\t\tthis.#observeBlockData(unique);\r\n\t\t\tthis.establishLiveSync();\r\n\t\t} else {\r\n\t\t\tthis.#layout.setValue(blockCreated.layout as LayoutDataType);\r\n\t\t\tthis.content.setData(blockCreated.content);\r\n\t\t\tif (blockCreated.settings) {\r\n\t\t\t\tthis.settings.setData(blockCreated.settings);\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\t#observeBlockData(unique: string) {\r\n\t\tif (!this.#blockEntries) {\r\n\t\t\tthrow new Error('Block Entries not found');\r\n\t\t}\r\n\t\tthis.observe(\r\n\t\t\tthis.#blockEntries.layoutOf(unique),\r\n\t\t\t(layoutData) => {\r\n\t\t\t\tthis.#layout.setValue(layoutData as LayoutDataType);\r\n\r\n\t\t\t\t// Content:\r\n\t\t\t\tconst contentKey = layoutData?.contentKey;\r\n\t\t\t\tif (!contentKey) {\r\n\t\t\t\t\treturn;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tthis.observe(\r\n\t\t\t\t\tthis.#blockManager!.contentOf(contentKey),\r\n\t\t\t\t\t(contentData) => {\r\n\t\t\t\t\t\tthis.content.setData(contentData);\r\n\t\t\t\t\t},\r\n\t\t\t\t\t'observeContent',\r\n\t\t\t\t);\r\n\t\t\t\tif (!this.#initialContent) {\r\n\t\t\t\t\tthis.observe(\r\n\t\t\t\t\t\tthis.#blockManager!.contentOf(contentKey),\r\n\t\t\t\t\t\t(contentData) => {\r\n\t\t\t\t\t\t\tthis.#initialContent ??= contentData;\r\n\t\t\t\t\t\t\tthis.removeUmbControllerByAlias('observeContentInitially');\r\n\t\t\t\t\t\t},\r\n\t\t\t\t\t\t'observeContentInitially',\r\n\t\t\t\t\t);\r\n\t\t\t\t}\r\n\r\n\t\t\t\t// Settings:\r\n\t\t\t\tconst settingsKey = layoutData?.settingsKey;\r\n\t\t\t\tif (settingsKey) {\r\n\t\t\t\t\tthis.observe(\r\n\t\t\t\t\t\tthis.#blockManager!.settingsOf(settingsKey),\r\n\t\t\t\t\t\t(settingsData) => {\r\n\t\t\t\t\t\t\tthis.settings.setData(settingsData);\r\n\t\t\t\t\t\t},\r\n\t\t\t\t\t\t'observeSettings',\r\n\t\t\t\t\t);\r\n\t\t\t\t\tif (!this.#initialSettings) {\r\n\t\t\t\t\t\tthis.observe(\r\n\t\t\t\t\t\t\tthis.#blockManager!.settingsOf(settingsKey),\r\n\t\t\t\t\t\t\t(settingsData) => {\r\n\t\t\t\t\t\t\t\tthis.#initialSettings ??= settingsData;\r\n\t\t\t\t\t\t\t\tthis.removeUmbControllerByAlias('observeSettingsInitially');\r\n\t\t\t\t\t\t\t},\r\n\t\t\t\t\t\t\t'observeSettingsInitially',\r\n\t\t\t\t\t\t);\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t},\r\n\t\t\t'observeLayout',\r\n\t\t);\r\n\t}\r\n\r\n\t/**\r\n\t * Establishes live synchronization of the block's layout, content, and settings data.\r\n\t * This method observes local changes in the layout, content, and settings data and pushes those updates to the block manager.\r\n\t * This method is used in live editing mode to ensure that changes made to the block's data are immediately reflected\r\n\t * in the backoffice UI.\r\n\t */\r\n\testablishLiveSync() {\r\n\t\t// Syncing Layout data is not a necessity, but it was an idea that someone might wanted to manipulate that from this workspace, but as it is giving trouble in Block Grid with Inline Editing Live Sync, then its taken out for now. [NL]\r\n\t\tlet initialLayoutSet = true;\r\n\t\tthis.observe(\r\n\t\t\tthis.layout,\r\n\t\t\t(layoutData) => {\r\n\t\t\t\tif (layoutData) {\r\n\t\t\t\t\tif (initialLayoutSet) {\r\n\t\t\t\t\t\tinitialLayoutSet = false;\r\n\t\t\t\t\t\treturn;\r\n\t\t\t\t\t}\r\n\t\t\t\t\tthis.#blockManager?.setOneLayout(layoutData, this.#originData);\r\n\t\t\t\t}\r\n\t\t\t},\r\n\t\t\t'observeThisLayout',\r\n\t\t);\r\n\t\tthis.observe(\r\n\t\t\tthis.content.data,\r\n\t\t\t(contentData) => {\r\n\t\t\t\tif (contentData) {\r\n\t\t\t\t\tthis.#blockManager?.setOneContent(contentData);\r\n\t\t\t\t}\r\n\t\t\t},\r\n\t\t\t'observeThisContent',\r\n\t\t);\r\n\t\tthis.observe(\r\n\t\t\tthis.settings.data,\r\n\t\t\t(settingsData) => {\r\n\t\t\t\tif (settingsData) {\r\n\t\t\t\t\tthis.#blockManager?.setOneSettings(settingsData);\r\n\t\t\t\t}\r\n\t\t\t},\r\n\t\t\t'observeThisSettings',\r\n\t\t);\r\n\t}\r\n\r\n\tgetData() {\r\n\t\treturn this.#layout.getValue();\r\n\t}\r\n\r\n\tgetUnique() {\r\n\t\treturn this.getData()!.contentKey;\r\n\t}\r\n\r\n\tgetEntityType() {\r\n\t\treturn this.#entityType;\r\n\t}\r\n\r\n\tgetName() {\r\n\t\treturn 'block name content element type here...';\r\n\t}\r\n\r\n\t/**\r\n\t * Check if there are unpersisted changes.\r\n\t * @returns { boolean } true if there are unpersisted changes.\r\n\t */\r\n\tpublic getHasUnpersistedChanges(): boolean {\r\n\t\treturn this.content.getHasUnpersistedChanges() || this.settings.getHasUnpersistedChanges();\r\n\t}\r\n\r\n\t/**\r\n\t * @function propertyValueByAlias\r\n\t * @param {string} propertyAlias - The alias of the property to get the value of.\r\n\t * @returns {Promise<Observable<ReturnType | undefined> | undefined>} - The value of the property.\r\n\t * @description Get an Observable for the value of this property.\r\n\t */\r\n\tasync propertyValueByAlias<propertyAliasType extends keyof LayoutDataType>(propertyAlias: propertyAliasType) {\r\n\t\treturn this.#layout.asObservablePart(\r\n\t\t\t(layout) => layout?.[propertyAlias as keyof LayoutDataType] as LayoutDataType[propertyAliasType],\r\n\t\t);\r\n\t}\r\n\r\n\tgetPropertyValue<propertyAliasType extends keyof LayoutDataType>(propertyAlias: propertyAliasType) {\r\n\t\t// TODO: Should be using Content, then we need a toggle or another method for getting settings.\r\n\t\treturn this.#layout.getValue()?.[propertyAlias as keyof LayoutDataType] as LayoutDataType[propertyAliasType];\r\n\t}\r\n\r\n\t/**\r\n\t * @function setPropertyValue\r\n\t * @param {string} alias - The alias of the property to set the value of.\r\n\t * @param {unknown} value - value can be a promise resolving into the actual value or the raw value it self.\r\n\t * @returns {Promise<void>}\r\n\t * @description Set the value of this property.\r\n\t */\r\n\tasync setPropertyValue(alias: string, value: unknown) {\r\n\t\tconst currentData = this.#layout.value;\r\n\t\tif (currentData) {\r\n\t\t\tthis.#layout.update({ ...currentData, [alias]: await value });\r\n\t\t}\r\n\t}\r\n\r\n\tasync submit() {\r\n\t\tconst layoutData = this.#layout.value;\r\n\t\tconst contentData = this.content.getData();\r\n\t\tif (!layoutData || !this.#blockManager || !this.#blockEntries || !contentData || !this.#originData) {\r\n\t\t\tthrow new Error('Missing data');\r\n\t\t}\r\n\r\n\t\tconst settingsData = this.settings.getData();\r\n\t\tthis.content.setPersistedData(contentData);\r\n\t\tif (settingsData) {\r\n\t\t\tthis.settings.setPersistedData(settingsData);\r\n\t\t}\r\n\r\n\t\tif (!this.#liveEditingMode) {\r\n\t\t\tif (this.getIsNew() === true) {\r\n\t\t\t\t// Insert (This means the layout entry will be inserted at the desired location):\r\n\t\t\t\tconst blockInserted = await this.#blockEntries.insert(layoutData, contentData, settingsData, this.#originData);\r\n\t\t\t\tif (!blockInserted) {\r\n\t\t\t\t\tthrow new Error('Block Entries could not insert block');\r\n\t\t\t\t}\r\n\t\t\t} else {\r\n\t\t\t\t// Update data:\r\n\r\n\t\t\t\tthis.#blockManager.setOneLayout(layoutData, this.#originData);\r\n\t\t\t\tif (contentData) {\r\n\t\t\t\t\tthis.#blockManager.setOneContent(contentData);\r\n\t\t\t\t}\r\n\t\t\t\tif (settingsData) {\r\n\t\t\t\t\tthis.#blockManager.setOneSettings(settingsData);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tthis.#expose(layoutData.contentKey);\r\n\t\tthis.setIsNew(false);\r\n\r\n\t\tthis.#reportValidation();\r\n\t}\r\n\r\n\t#reportValidation() {\r\n\t\tthis.content.validation.report();\r\n\t\tthis.settings.validation.report();\r\n\t}\r\n\r\n\texpose() {\r\n\t\tconst contentKey = this.#layout.value?.contentKey;\r\n\t\tif (!contentKey) throw new Error('Failed to expose block, missing content key.');\r\n\t\tthis.#expose(contentKey);\r\n\t}\r\n\r\n\t#expose(unique: string) {\r\n\t\tconst variantId = this.#variantId.getValue();\r\n\t\tif (!variantId) throw new Error('Failed to expose block, missing variant id.');\r\n\t\tthis.#blockManager?.setOneExpose(unique, variantId);\r\n\t}\r\n\r\n\t#modalRejected = () => {\r\n\t\tif (this.#liveEditingMode) {\r\n\t\t\t// Revert\r\n\t\t\t// Did it exist before?\r\n\t\t\tif (this.getIsNew() === true) {\r\n\t\t\t\t// Remove the block?\r\n\t\t\t\tconst contentKey = this.#layout.value?.contentKey;\r\n\t\t\t\tif (contentKey) {\r\n\t\t\t\t\tthis.#blockEntries?.delete(contentKey);\r\n\t\t\t\t}\r\n\t\t\t} else {\r\n\t\t\t\t// Revert the layout, content & settings data to the original state: [NL]\r\n\t\t\t\tif (this.#initialLayout) {\r\n\t\t\t\t\tthis.#blockManager?.setOneLayout(this.#initialLayout, this.#originData);\r\n\t\t\t\t}\r\n\t\t\t\tif (this.#initialContent) {\r\n\t\t\t\t\tthis.#blockManager?.setOneContent(this.#initialContent);\r\n\t\t\t\t}\r\n\t\t\t\tif (this.#initialSettings) {\r\n\t\t\t\t\tthis.#blockManager?.setOneContent(this.#initialSettings);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t};\r\n\r\n\tpublic override destroy(): void {\r\n\t\tsuper.destroy();\r\n\t\twindow.removeEventListener('willchangestate', this.#onWillNavigate);\r\n\t\tthis.#layout?.destroy();\r\n\t\tthis.#name?.destroy();\r\n\t\tthis.#layout = undefined as any;\r\n\t\tthis.#name = undefined as any;\r\n\t\tthis.#blockManager = undefined;\r\n\t\tthis.#originData = undefined;\r\n\t}\r\n}\r\n\r\nexport { UmbBlockWorkspaceContext as api };\r\n"],"names":["UmbBlockWorkspaceEditorElement","UmbLitElement","UMB_BLOCK_WORKSPACE_CONTEXT","context","observeMultiple","contentType","isNew","name","html","UmbTextStyles","css","__decorateClass","state","customElement","UmbBlockElementPropertyDatasetContext","UmbElementPropertyDatasetContext","host","elementManager","variantId","createObservablePart","v","workspace","states","isReadOnly","UmbBlockElementManager","UmbControllerBase","dataPathPropertyName","#data","UmbElementWorkspaceDataManager","#getDataPromise","resolve","#getDataResolver","UmbReadOnlyVariantStateManager","#variantId","UmbClassState","data","#dataTypeItemManager","UmbDataTypeItemRepositoryManager","#dataTypeSchemaAliasMap","UmbContentTypeStructureManager","UmbDocumentTypeDetailRepository","UmbValidationController","id","key","dataTypeUniques","dataTypes","dataType","UmbVariantId","#createPropertyVariantId","property","propertyAlias","mergeObservables","x","alias","currentData","value","editorAlias","entry","values","appendToFrozenArray","UmbBlockWorkspaceContext","UmbSubmittableWorkspaceContextBase","workspaceArgs","#layout","UmbObjectState","#name","UmbStringState","#exposed","UmbBooleanState","#allowNavigateAway","#onWillNavigate","e","newUrl","modal","UMB_MODAL_MANAGER_CONTEXT","UMB_DISCARD_CHANGES_MODAL","#modalRejected","#liveEditingMode","contentKey","#blockEntries","#initialLayout","#blockManager","#originData","#initialContent","#initialSettings","manifest","#entityType","#retrieveModalContext","UMB_MODAL_CONTEXT","#modalContext","#retrieveBlockManager","UMB_BLOCK_MANAGER_CONTEXT","manager","#gotManager","#retrieveBlockEntries","UMB_BLOCK_ENTRIES_CONTEXT","UMB_BLOCK_ENTRY_CONTEXT","component","info","elementTypeKey","UmbWorkspaceIsNewRedirectController","decodeFilePath","liveEditingMode","variesByCulture","variesBySegment","exposed","unique","contentTypeId","blockType","editorSize","UmbWorkspaceIsNewRedirectControllerAlias","layoutData","#observeBlockData","contentElementTypeId","blockCreated","contentData","settingsKey","settingsData","initialLayoutSet","layout","#expose","#reportValidation"],"mappings":"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"}